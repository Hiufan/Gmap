function load_map(){gm_init=function(){var e,t,a,o,n;return n=[],n.push(google.maps.MapTypeId.ROADMAP),n.push(google.maps.MapTypeId.TERRAIN),n.push(google.maps.MapTypeId.SATELLITE),n.push(google.maps.MapTypeId.HYBRID),n.push("OSM"),n.push("TFL"),t=new google.maps.LatLng(50.633333,5.566667),a=google.maps.MapTypeId.ROADMAP,o={zoom:14,center:t,panControl:!1,backgroundColor:"rgba(0,0,0,0)",disableDoubleClickZoom:!0,scrollwheel:!1,draggableCursor:"crosshair",mapTypeControlOptions:{mapTypeIds:n,style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},e=new google.maps.Map(this.map_canvas,o),e.mapTypes.set("OSM",new google.maps.ImageMapType({getTileUrl:function(e,t){return"http://tile.openstreetmap.org/"+t+"/"+e.x+"/"+e.y+".png"},tileSize:new google.maps.Size(256,256),name:"OSM",maxZoom:18})),e.mapTypes.set("TFL",new google.maps.ImageMapType({getTileUrl:function(e,t){return"http://tile.thunderforest.com/landscape/"+t+"/"+e.x+"/"+e.y+".png"},tileSize:new google.maps.Size(256,256),name:"TF Landscape",maxZoom:18})),e},poly_init=function(){var e={geodesic:!0,map:map,strokeColor:"rgba(0,0,0,0.6)"};return new google.maps.Polyline(e)},draw_path=function(e){if(!elevationReqActive&&e){var t={path:e,samples:SAMPLES};return elevationReqActive=!0,elevation_service.getElevationAlongPath(t,plot_elevation)}},plot_elevation=function(e,t){if(elevationReqActive=!1,t===google.maps.ElevationStatus.OK){for(elevations=e,data=new google.visualization.DataTable,data.addColumn("string","Distance"),data.addColumn("number","Elevation"),i=0;i<e.length;i+=1)data.addRow(["",elevations[i].elevation]);elevation_chart.style.display="block",options={height:100,dataOpacity:.8,bar:{groupWidth:"100%"},legend:{position:"none"},titleY:"Elevation (m)",fill:"#00AA00",vAxis:{minValue:0},colors:["#3498db"],focusBorderColor:"#00AA00",tooltip:{trigger:"none"}},chart.draw(data,options)}},add_chart_listener=function(){infowindow=new google.maps.InfoWindow({}),google.visualization.events.addListener(chart,"onmouseover",function(e){null===mousemarker?(mousemarker=new google.maps.Marker({position:elevations[e.row].location,map:map,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),contentStr="elevation="+elevations[e.row].elevation+"m",mousemarker.contentStr=contentStr,google.maps.event.addListener(mousemarker,"click",function(){mm_infowindow_open=!0,infowindow.setContent(this.contentStr),infowindow.open(map,mousemarker)})):(mousemarker.setMap(map),contentStr="elevation="+elevations[e.row].elevation+"m",mousemarker.contentStr=contentStr,infowindow.setContent(contentStr),mousemarker.setPosition(elevations[e.row].location))})},create_track=function(e,t){path.push(e),poly.setPath(path),start_marker=new google.maps.Marker({map:t,position:e,icon:"http://maps.google.com/mapfiles/dd-start.png"})},extend_track=function(e,t){gm_service.route({origin:e,destination:t,travelMode:google.maps.DirectionsTravelMode.WALKING},function(e,a){if(a===google.maps.DirectionsStatus.OK)for(var o=0;o<e.routes[0].overview_path.length;o++)path.push(e.routes[0].overview_path[o]),draw_path(path.j),update_dist(),end_marker.setMap(map),end_marker.setPosition(t)})},update_dist=function(){var e=google.maps.geometry.spherical.computeLength(poly.getPath()).toString();null!==e.match(THREENUMBERS_DOT_NUMBERS)?e=e.replace(THREENUMBERS_DOT_NUMBERS,"0.$1"):(e=e.replace(NUMBERS_DOT_THREENUMBERS,"$1.$2"),dist.childNodes[0].textContent=e+"km")},truncate_track=function(){path.j.length<=2?clear_all():(path.j.pop(),poly.setPath(path),draw_path(path.j),new_pos=gm_center=new google.maps.LatLng(path.j[path.j.length-1].lat(),path.j[path.j.length-1].lng()),end_marker.setPosition(new_pos),update_dist())},undo_action=function(){if(previous_point.length>=2){tmp_previous_point=path.j.length-previous_point[previous_point.length-1],tmp_path=path.j.slice(0).reverse();for(var e=0;e<path.j.slice(0).reverse().length;e++)tmp_previous_point>e&&tmp_path.shift();path.j=tmp_path.slice(0).reverse(),poly.setPath(path),draw_path(path.j),new_pos=gm_center=new google.maps.LatLng(path.j[path.j.length-1].lat(),path.j[path.j.length-1].lng()),end_marker.setPosition(new_pos),previous_point.pop(),update_dist()}else clear_all()},clear_all=function(){path.clear(),previous_point=[],elevation_chart.style.display="none",dist.childNodes[0].nodeValue="0km",null!==start_marker&&start_marker.setMap(null),null!==end_marker&&end_marker.setMap(null),null!==mousemarker&&mousemarker.setMap(null)},(init=function(){clear_all();var e=(document.getElementById("dist"),document.getElementById("reset")),t=document.getElementById("close"),a=(document.getElementById("clear"),document.getElementById("full"),document.getElementById("back")),o=document.getElementById("tiny"),n=(document.getElementById("map_canvas"),document.getElementById("elevation_chart"));chart=new google.visualization.ColumnChart(n),map=gm_init(),map.setOptions({draggableCursor:"crosshair"}),poly=poly_init(),add_chart_listener(),end_marker=new google.maps.Marker({map:map,icon:"http://maps.google.com/mapfiles/dd-end.png"}),e.addEventListener("click",function(){clear_all()}),o.addEventListener("click",function(){truncate_track()}),a.addEventListener("click",function(){undo_action()}),t.addEventListener("click",function(){0!=path.getLength()&&extend_track(path.getAt(path.j.length-1),path.getAt(0))}),google.maps.event.addListener(map,"click",function(e){0==path.getLength()?create_track(e.latLng,map):(previous_point.push(path.j.length-1),extend_track(path.getAt(path.j.length-1),e.latLng))})})()}var NUMBERS_DOT_THREENUMBERS=/^(\d+)(\d{3})(\.\d+)/,THREENUMBERS_DOT_NUMBERS=/^(\d{3})(\.\d+)/,NUMBERS_DOT_NUMBERS=/^(\d+)(\.\d+)/,COORD=/^(\d+\.)(\d{0,13})(\d+)/,poly=1,chart=1,map=1,elevations=1,SAMPLES=100,mousemarker=null,track_path=null,newRoute=[],dist_markers=[],jsInput=null,elevationReqActive=!1,end_marker=null,start_marker=null,path=new google.maps.MVCArray,gm_service=new google.maps.DirectionsService,elevation_service=new google.maps.ElevationService,previous_point=[];google.load("visualization","1",{packages:["columnchart"]}),google.maps.event.addDomListener(window,"load",load_map);